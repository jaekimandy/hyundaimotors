import{u as e,w as K,i as Ce,s as oe,r as V,a as _e,b as N,e as we,f as ge,h as D,o as E,j as R,k as l,l as s,F as Z,C as re,m as i,t as P,p as H,q as I,v as ie,x as ue,y as de,z as M,A as j,B as z,D as q,E as G,G as ce,c as ae,H as he,I as be,J as Pe,K as Se,L as Fe,M as ke,N as Le,O as xe,P as Be,Q as le,R as X,S as Te,T as J,U as fe,V as Ue,W as Ee}from"./entry.561ade7d.js";import{C as Ie,p as Ve,a as Ae,b as De,B as Oe,L as $e,c as Ne,d as Re,P as He,T as Me}from"./chart.742e63cc.js";import{p as je,L as ze}from"./chartjs-plugin-zoom.esm.75645d00.js";function W(n){return typeof n=="function"?n():e(n)}const pe=()=>{};function se(n,u=!1,d="Timeout"){return new Promise((p,f)=>{setTimeout(u?()=>f(d):p,n)})}function te(n,u=!1){function d(r,{flush:v="sync",deep:h=!1,timeout:S,throwOnTimeout:U}={}){let b=null;const F=[new Promise(x=>{b=K(n,w=>{r(w)!==u&&(b==null||b(),x(w))},{flush:v,deep:h,immediate:!0})})];return S!=null&&F.push(se(S,U).then(()=>W(n)).finally(()=>b==null?void 0:b())),Promise.race(F)}function p(r,v){if(!Ce(r))return d(w=>w===r,v);const{flush:h="sync",deep:S=!1,timeout:U,throwOnTimeout:b}=v??{};let _=null;const x=[new Promise(w=>{_=K([n,r],([Q,Y])=>{u!==(Q===Y)&&(_==null||_(),w(Q))},{flush:h,deep:S,immediate:!0})})];return U!=null&&x.push(se(U,b).then(()=>W(n)).finally(()=>(_==null||_(),W(n)))),Promise.race(x)}function f(r){return d(v=>!!v,r)}function T(r){return p(null,r)}function m(r){return p(void 0,r)}function y(r){return d(Number.isNaN,r)}function A(r,v){return d(h=>{const S=Array.from(h);return S.includes(r)||S.includes(W(r))},v)}function k(r){return L(1,r)}function L(r=1,v){let h=-1;return d(()=>(h+=1,h>=r),v)}return Array.isArray(W(n))?{toMatch:d,toContains:A,changed:k,changedTimes:L,get not(){return te(n,!u)}}:{toMatch:d,toBe:p,toBeTruthy:f,toBeNull:T,toBeNaN:y,toBeUndefined:m,changed:k,changedTimes:L,get not(){return te(n,!u)}}}function qe(n){return te(n)}var Ge=Object.defineProperty,Je=Object.defineProperties,We=Object.getOwnPropertyDescriptors,ye=Object.getOwnPropertySymbols,Ke=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable,me=(n,u,d)=>u in n?Ge(n,u,{enumerable:!0,configurable:!0,writable:!0,value:d}):n[u]=d,Ze=(n,u)=>{for(var d in u||(u={}))Ke.call(u,d)&&me(n,d,u[d]);if(ye)for(var d of ye(u))Qe.call(u,d)&&me(n,d,u[d]);return n},Xe=(n,u)=>Je(n,We(u));function ve(n,u,d){const{immediate:p=!0,delay:f=0,onError:T=pe,onSuccess:m=pe,resetOnExecute:y=!0,shallow:A=!0,throwError:k}=d??{},L=A?oe(u):V(u),r=V(!1),v=V(!1),h=oe(void 0);async function S(_=0,...F){y&&(L.value=u),h.value=void 0,r.value=!1,v.value=!0,_>0&&await se(_);const x=typeof n=="function"?n(...F):n;try{const w=await x;L.value=w,r.value=!0,m(w)}catch(w){if(h.value=w,T(w),k)throw w}finally{v.value=!1}return L.value}p&&S(f);const U={state:L,isReady:r,isLoading:v,error:h,execute:S};function b(){return new Promise((_,F)=>{qe(v).toBe(!1).then(()=>_(U)).catch(F)})}return Xe(Ze({},U),{then(_,F){return b().then(_,F)}})}const Ye={class:"d-grid gap-2 d-md-flex"},ea={key:0},aa={key:1},la=["alt","src"],sa={class:"mb-3"},ta={class:"mb-3"},na=["src"],oa=_e({__name:"[id]",async setup(n){let u,d;Ie.register(Ve,Ae,De,Oe,$e,Ne,Re,He,je,Me);const p=N({show:!1,message:"",title:""}),f=N({step:0,startPos:0,endPos:0}),T=N({show:!1}),m=N({show:!1,loading:!1,title:""}),y=N({show:!1,loading:!1,loaded:!1,title:"",chartData:[]}),A=N({show:!1,levelCrossingImage:""}),k=V([]),L=Ue(),r=c=>{var t,o,C;const a=document.getElementById(`image-${c}`);((t=a==null?void 0:a.style)==null?void 0:t.display)==="none"?(o=a==null?void 0:a.style)==null||o.setProperty("display","block"):(C=a==null?void 0:a.style)==null||C.setProperty("display","none")},v=c=>`image-${c}`,h=c=>`${L.public.IMAGE_URL}${c}`,S=c=>{const a=c.target.files[0];y.loaded=!1,(o=>new Promise((C,g)=>{const B=new FileReader;B.onload=()=>C(B.result),B.onerror=g,B.readAsText(o)}))(a).then(o=>{y.chartData=o,y.loaded=!0})},U=()=>{const{state:c}=ve(D({operation:"analysisLevelCrossings",variables:{analysisFileId:O.params.id}}).then(a=>{var t,o;return(o=(t=a.data)==null?void 0:t.value)==null?void 0:o.analysisLevelCrossings}),{});K(()=>c.value,a=>{k.value=a})},b=c=>{const{state:a}=ve(D({operation:"analysisLevelCrossing",variables:{id:c}}).then(t=>{var o,C;return(C=(o=t.data)==null?void 0:o.value)==null?void 0:C.analysisLevelCrossing}),{id:null},{delay:1e4});K(()=>a.value,t=>{t.status==="PENDING"?b(c):U()})},_=async()=>{var a,t,o;y.loading=!0;const{data:c}=await D({operation:"createAnalysisLevelCrossing",variables:{analysisFileId:O.params.id,chartData:y.chartData,title:y.title}});if(c.value){const C=(o=(t=(a=c.value)==null?void 0:a.createAnalysisLevelCrossing)==null?void 0:t.analysisLevelCrossing)==null?void 0:o.id;C&&b(C),await D({operation:"analysisLevelCrossings",variables:{analysisFileId:O.params.id}}).then(g=>(k.value=g.data.value.analysisLevelCrossings,g)).finally(()=>{y.loading=!1,y.show=!1})}else y.loading=!1,y.show=!1},F=async()=>{var t,o,C;f.step=0,m.loading=!0;const c=ee.value.slice(f.startPos,m.endPos),{data:a}=await D({operation:"createAnalysisLevelCrossing",variables:{analysisFileId:O.params.id,chartData:ne.value.concat(c).join(`\r
`),title:m.title}});if(a.value){const g=(C=(o=(t=a.value)==null?void 0:t.createAnalysisLevelCrossing)==null?void 0:o.analysisLevelCrossing)==null?void 0:C.id;g&&b(g),await D({operation:"analysisLevelCrossings",variables:{analysisFileId:O.params.id}}).then(B=>(k.value=B.data.value.analysisLevelCrossings,B)).finally(()=>{m.loading=!1,m.show=!1})}else m.loading=!1,m.show=!1},x=V({labels:["1","2"],datasets:[{data:[10,20]}]});K(()=>f.step,c=>{switch(c){case 1:p.title="구간선택",p.message="시작위치 구간을 선택하세요",p.show=!0;break;case 2:p.title="구간선택",p.message="완료위치 구간을 선택하세요",p.show=!0;break;case 3:p.title="구간선택",p.message=`구간 선택이 완료되었습니다
선택하신 구간은 ${f.startPos} ~ ${f.endPos} 입니다`,p.show=!0;break;case 4:T.show=!0;break}});const w=()=>{switch(f.step){case 0:f.step=1;break}},Q=()=>{y.show=!0},Y=V({responsive:!0,onClick:(c,a)=>{if(!(a.length<=0))switch(f.step){case 1:f.startPos=a[0].index,f.step=2;break;case 2:f.endPos=a[0].index,f.step=3;break}}}),O=we(),$=V(void 0),ee=V(),ne=V();return[u,d]=ge(()=>D({operation:"analysisFile",variables:{id:O.params.id}}).then(c=>{const{data:a}=c;if(a.value){$.value={carType:a.value.analysisFile.carType,year:a.value.analysisFile.year,area:a.value.analysisFile.area,roadSurface:a.value.analysisFile.roadSurface,weight:a.value.analysisFile.weight,testCount:a.value.analysisFile.testCount,chartData:a.value.analysisFile.chartData};const t=a.value.analysisFile.chartData.split(`\r
`),o=t[2].split(",").findIndex(g=>g==="Front Left Wheel Center Force (Z)");ne.value=t.slice(0,8),ee.value=t.slice(8);const C=ee.value.map(g=>{const B=g.split(",");return{x:B[0],y:B[o]}});x.value.labels=C.map(g=>g.x),x.value.datasets[0].data=C.map(g=>g.y)}}).finally(()=>{})),await u,d(),D({operation:"analysisLevelCrossings",variables:{analysisFileId:O.params.id}}).then(c=>(k.value=c.data.value.analysisLevelCrossings,c)).finally(()=>{}),(c,a)=>(E(),R(Z,null,[l(e(ue),{class:"mb-4"},{default:s(()=>[l(e(re),null,{default:s(()=>[i(P(e($).carType)+"-"+P(e($).year)+"-"+P(e($).area)+" / "+P(e($).weight)+"-"+P(e($).roadSurface)+"-"+P(e($).testCount)+" ",1),H("div",Ye,[l(e(I),{color:"primary",class:"me-md-2",size:"sm",onClick:w},{default:s(()=>[i("구간선택")]),_:1}),l(e(I),{color:"primary",size:"sm",onClick:Q},{default:s(()=>[i("구간파일업로드")]),_:1})])]),_:1}),l(e(ie),null,{default:s(()=>[l(e(ze),{ref:"chart",options:e(Y),data:e(x)},null,8,["options","data"])]),_:1})]),_:1}),l(e(ue),{class:"mb-4"},{default:s(()=>[l(e(re),null,{default:s(()=>[i(" 구간목록 ")]),_:1}),l(e(ie),null,{default:s(()=>[(E(!0),R(Z,null,de(e(k),t=>(E(),ae(e(he),{key:t.id},{default:s(()=>[l(e(be),null,{default:s(()=>[l(e(Pe),{disabled:t.status!=="SUCCESS"},{default:s(()=>[H("span",null,P(t.title),1),t.status!=="SUCCESS"?(E(),R("span",ea,[i(" ("),Se(l(e(Fe),{color:"primary",size:"sm"},null,512),[[ke,t.status!=="SUCCESS"]]),i(") ")])):(E(),R("span",aa," ("+P(t.status)+") ",1))]),_:2},1032,["disabled"]),t.status==="SUCCESS"?(E(),ae(e(Le),{key:0},{default:s(()=>[l(e(xe),null,{default:s(()=>[l(e(Be),null,{default:s(()=>[l(e(le),null,{default:s(()=>[l(e(X),null,{default:s(()=>[i("컬럼명")]),_:1}),l(e(X),null,{default:s(()=>[i("Damage")]),_:1}),l(e(X),null,{default:s(()=>[i("상태")]),_:1}),l(e(X),null,{default:s(()=>[i("이미지")]),_:1})]),_:1})]),_:1}),l(e(Te),null,{default:s(()=>[(E(!0),R(Z,null,de(JSON.parse(t.images),o=>(E(),R(Z,null,[l(e(le),null,{default:s(()=>[l(e(J),null,{default:s(()=>[i(P(o.columnName),1)]),_:2},1024),l(e(J),null,{default:s(()=>[i(P(o.damage),1)]),_:2},1024),l(e(J),null,{default:s(()=>[i(P(o.status),1)]),_:2},1024),l(e(J),null,{default:s(()=>[l(e(I),{size:"small",disabled:o.status!=="SUCCESS",onClick:C=>r(o==null?void 0:o.id)},{default:s(()=>[i("이미지보기")]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024),o.status==="SUCCESS"?(E(),ae(e(le),{key:0,id:v(o.id),style:{display:"none"}},{default:s(()=>[l(e(J),{colspan:"4"},{default:s(()=>[H("img",{alt:o.columnName,src:h(o.filename)},null,8,la)]),_:2},1024)]),_:2},1032,["id"])):fe("",!0)],64))),256))]),_:2},1024)]),_:2},1024)]),_:2},1024)):fe("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),l(e(q),{visible:e(p).show,onClose:a[1]||(a[1]=()=>{e(p).show=!1})},{default:s(()=>[l(e(M),null,{default:s(()=>[i(P(e(p).title),1)]),_:1}),l(e(j),null,{default:s(()=>[i(P(e(p).message),1)]),_:1}),l(e(z),null,{default:s(()=>[l(e(I),{color:"secondary",onClick:a[0]||(a[0]=()=>{e(p).show=!1,e(f).step===3&&(e(f).step=4)})},{default:s(()=>[i(" 확인 ")]),_:1})]),_:1})]),_:1},8,["visible"]),l(e(q),{visible:e(T).show,onClose:a[6]||(a[6]=()=>{e(T).show=!1})},{default:s(()=>[l(e(M),null,{default:s(()=>[i("선택하신 구간으로 저장하시겠습니까?")]),_:1}),l(e(j),null,{default:s(()=>[H("div",sa,[l(e(G),{modelValue:e(f).startPos,"onUpdate:modelValue":a[2]||(a[2]=t=>e(f).startPos=t),type:"text",label:"시작위치"},null,8,["modelValue"])]),H("div",ta,[l(e(G),{modelValue:e(f).endPos,"onUpdate:modelValue":a[3]||(a[3]=t=>e(f).endPos=t),type:"text",label:"완료위치"},null,8,["modelValue"])])]),_:1}),l(e(z),null,{default:s(()=>[l(e(I),{color:"secondary",onClick:a[4]||(a[4]=()=>{e(T).show=!1})},{default:s(()=>[i(" 취소 ")]),_:1}),l(e(I),{color:"primary",onClick:a[5]||(a[5]=()=>{e(T).show=!1,e(m).show=!0})},{default:s(()=>[i(" 잔행 ")]),_:1})]),_:1})]),_:1},8,["visible"]),l(e(q),{visible:e(y).show,onClose:a[10]||(a[10]=()=>{e(y).show=!1})},{default:s(()=>[l(e(M),null,{default:s(()=>[i("구간명을 입력하세요")]),_:1}),l(e(j),null,{default:s(()=>[l(e(G),{modelValue:e(y).title,"onUpdate:modelValue":a[7]||(a[7]=t=>e(y).title=t),type:"text",label:"구간명"},null,8,["modelValue"]),l(e(G),{type:"file",label:"구간파일",onChange:a[8]||(a[8]=t=>S(t))})]),_:1}),l(e(z),null,{default:s(()=>[l(e(I),{color:"secondary",disabled:e(y).loading,onClick:a[9]||(a[9]=()=>{e(y).show=!1})},{default:s(()=>[i(" 닫기 ")]),_:1},8,["disabled"]),l(e(ce),{loading:e(y).loading,disabled:!e(y).loaded,color:"primary",onClick:_},{default:s(()=>[i(" 저장 ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["visible"]),l(e(q),{visible:e(m).show,onClose:a[13]||(a[13]=()=>{e(m).show=!1})},{default:s(()=>[l(e(M),null,{default:s(()=>[i("구간명을 입력하세요")]),_:1}),l(e(j),null,{default:s(()=>[l(e(G),{modelValue:e(m).title,"onUpdate:modelValue":a[11]||(a[11]=t=>e(m).title=t),type:"text",label:"구간명"},null,8,["modelValue"])]),_:1}),l(e(z),null,{default:s(()=>[l(e(I),{color:"secondary",disabled:e(m).loading,onClick:a[12]||(a[12]=()=>{e(p).show=!1})},{default:s(()=>[i(" 닫기 ")]),_:1},8,["disabled"]),l(e(ce),{loading:e(m).loading,color:"primary",onClick:F},{default:s(()=>[i(" 저장 ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["visible"]),l(e(q),{visible:e(A).show,size:"lg",onClose:a[15]||(a[15]=()=>{e(A).show=!1})},{default:s(()=>[l(e(M),null,{default:s(()=>[i("Level Crossing")]),_:1}),l(e(j),null,{default:s(()=>[H("img",{src:e(A).levelCrossingImage,alt:""},null,8,na)]),_:1}),l(e(z),null,{default:s(()=>[l(e(I),{color:"secondary",onClick:a[14]||(a[14]=()=>{e(A).show=!1})},{default:s(()=>[i(" 닫기 ")]),_:1})]),_:1})]),_:1},8,["visible"])],64))}});const da=Ee(oa,[["__scopeId","data-v-d5250cf8"]]);export{da as default};
